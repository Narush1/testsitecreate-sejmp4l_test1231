<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Игра с сеткой и двумя канвасами</title>
<style>
  html, body {
    margin: 0; padding: 0; overflow: hidden;
    background: #111;
    height: 100%;
  }
  #gridCanvas, #gameCanvas {
    position: absolute;
    top: 0; left: 0;
    width: 100vw;
    height: 100vh;
    display: block;
  }
  #gridCanvas {
    z-index: 0;
    background: #222;
  }
  #gameCanvas {
    z-index: 1;
    pointer-events: none; /* чтобы клики не блокировались, если надо */
  }
</style>
</head>
<body>

<canvas id="gridCanvas"></canvas>
<canvas id="gameCanvas"></canvas>

<script>
const gridCanvas = document.getElementById('gridCanvas');
const gridCtx = gridCanvas.getContext('2d');

const gameCanvas = document.getElementById('gameCanvas');
const gameCtx = gameCanvas.getContext('2d');

let width, height;
const mapSize = 20000;
const spacing = 200;

function resize() {
  width = window.innerWidth;
  height = window.innerHeight;
  gridCanvas.width = width;
  gridCanvas.height = height;
  gameCanvas.width = width;
  gameCanvas.height = height;
}
window.addEventListener('resize', resize);
resize();

// Камера, начальное положение — центр карты
let cam = { x: mapSize / 2, y: mapSize / 2 };
let keys = {};

window.addEventListener('keydown', e => {
  keys[e.key.toLowerCase()] = true;
});
window.addEventListener('keyup', e => {
  keys[e.key.toLowerCase()] = false;
});

function drawGrid(camX, camY) {
  gridCtx.clearRect(0, 0, width, height);

  const startX = -camX % spacing;
  const startY = -camY % spacing;

  gridCtx.strokeStyle = 'rgba(255, 255, 255, 0.15)';
  gridCtx.lineWidth = 1.5;

  for (let x = startX; x < width; x += spacing) {
    gridCtx.beginPath();
    gridCtx.moveTo(x, 0);
    gridCtx.lineTo(x, height);
    gridCtx.stroke();
  }
  for (let y = startY; y < height; y += spacing) {
    gridCtx.beginPath();
    gridCtx.moveTo(0, y);
    gridCtx.lineTo(width, y);
    gridCtx.stroke();
  }

  // Красный крест в центре карты для ориентира
  const centerX = mapSize / 2 - camX;
  const centerY = mapSize / 2 - camY;
  gridCtx.strokeStyle = 'red';
  gridCtx.lineWidth = 3;
  gridCtx.beginPath();
  gridCtx.moveTo(centerX - 10, centerY);
  gridCtx.lineTo(centerX + 10, centerY);
  gridCtx.moveTo(centerX, centerY - 10);
  gridCtx.lineTo(centerX, centerY + 10);
  gridCtx.stroke();
}

function drawPlayer(screenX, screenY, color = '#4caf50') {
  const size = 50;
  const r = 12;

  gameCtx.fillStyle = color;
  gameCtx.beginPath();
  gameCtx.moveTo(screenX + r, screenY);
  gameCtx.lineTo(screenX + size - r, screenY);
  gameCtx.quadraticCurveTo(screenX + size, screenY, screenX + size, screenY + r);
  gameCtx.lineTo(screenX + size, screenY + size - r);
  gameCtx.quadraticCurveTo(screenX + size, screenY + size, screenX + size - r, screenY + size);
  gameCtx.lineTo(screenX + r, screenY + size);
  gameCtx.quadraticCurveTo(screenX, screenY + size, screenX, screenY + size - r);
  gameCtx.lineTo(screenX, screenY + r);
  gameCtx.quadraticCurveTo(screenX, screenY, screenX + r, screenY);
  gameCtx.closePath();
  gameCtx.fill();
}

function update() {
  const speed = 10;
  if (keys['w']) cam.y -= speed;
  if (keys['s']) cam.y += speed;
  if (keys['a']) cam.x -= speed;
  if (keys['d']) cam.x += speed;

  // Ограничения по размеру карты
  cam.x = Math.min(Math.max(0, cam.x), mapSize);
  cam.y = Math.min(Math.max(0, cam.y), mapSize);
}

function loop() {
  update();

  // Рисуем сетку с учетом камеры
  drawGrid(cam.x, cam.y);

  // Очищаем игровой канвас и рисуем игрока по центру экрана
  gameCtx.clearRect(0, 0, width, height);
  drawPlayer(width / 2 - 25, height / 2 - 25);

  requestAnimationFrame(loop);
}

loop();
</script>

</body>
</html>
